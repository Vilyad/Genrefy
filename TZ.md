# Техническое задание: Genrefy

## 1. Цель проекта
Разработка веб-сервиса для анализа музыкальных жанров и подбора референс-треков, предназначенного для начинающих музыкальных продюсеров. Сервис помогает находить релевантные примеры для изучения и понимать основные характеристики жанров через интеграцию с Last.fm API.

**Актуальность проекта:** Начинающим продюсерам необходимо изучать успешные треки в выбранных жанрах. Ручной поиск и анализ требует времени, тогда как автоматизированная система предоставляет структурированные данные о популярности, тегах и жанровой принадлежности треков.

## 2. Архитектурное решение

### Выбор технологии:

Используется **Last.fm API** по следующим причинам:

1. **Доступность в России:** Работает без географических ограничений
2. **Приемлемые лимиты:** 5,000 запросов в день бесплатно
3. **Богатая база данных:** Миллионы треков, артистов, тегов и жанров
4. **Стабильность:** Проверенный годами API с хорошей документацией
5. **Простота интеграции:** JSON API с понятной структурой ответов

## 3. Роли пользователей
- **Гость (неавторизованный пользователь)**:
   - Просмотр каталога музыкальных жанров
   - Поиск треков и артистов через Last.fm API
   - Просмотр популярных треков по жанрам
   - Доступ к статистике и аналитическим графикам
   - Базовый анализ характеристик жанров

- **Зарегистрированный пользователь (планируется в будущем)**:
   - Сохранение избранных треков и жанров
   - Создание персональных коллекций
   - Отслеживание изменений в популярности
   - Экспорт данных для дальнейшего анализа

- **Администратор**:
   - Управление контентом через Django Admin
   - Обновление данных через внешние API
   - Модерация пользовательского контента
   - Анализ использования системы

## 4. Модели данных

### Модель 1: Genre (Музыкальный жанр)
- `name` - название жанра (CharField, 100)
- `description` - описание жанра (TextField)
- `lastfm_tag` - соответствующий тег в Last.fm (CharField, 100)
- `created_at` - дата создания (DateTimeField)
- `updated_at` - дата обновления (DateTimeField)

### Модель 2: Artist (Исполнитель)
- `name` - имя исполнителя (CharField, 200)
- `lastfm_url` - страница артиста на Last.fm (URLField)
- `lastfm_listeners` - количество слушателей (IntegerField)
- `genres` - жанры исполнителя (ManyToMany с Genre)
- `created_at` - дата добавления (DateTimeField)

### Модель 3: Track (Музыкальный трек)
- `title` - название трека (CharField, 200)
- `artist` - исполнитель (ForeignKey к Artist)
- `lastfm_url` - страница трека на Last.fm (URLField)
- `lastfm_listeners` - количество слушателей (IntegerField)
- `lastfm_playcount` - количество прослушиваний (IntegerField)
- `duration` - продолжительность в секундах (IntegerField, null=True)
- `is_reference` - является ли референс-треком (BooleanField, default=False)
- `genres` - список жанров (TextField)
- `created_at` - дата добавления (DateTimeField)

## 5. Ключевые сценарии (User Stories)

### Базовый функционал:
1. **"Как пользователь, я хочу просматривать каталог музыкальных жанров"**
   - Страница со списком всех жанров
   - Карточки жанров с основной информацией
   - Количество треков и артистов в каждом жанре

2. **"Как продюсер, я хочу найти референс-треки в конкретном жанре"**
   - Детальная страница жанра со списком треков
   - Фильтрация треков по популярности
   - Статистика жанра (средние показатели популярности)

3. **"Как пользователь, я хочу искать треки и артистов через Last.fm API"**
   - Форма поиска по названию трека и исполнителю
   - Результаты поиска с информацией из Last.fm
   - Возможность добавления найденных треков в базу данных

4. **"Как пользователь, я хочу анализировать популярность жанров"**
   - Графики распределения треков по жанрам
   - Диаграммы популярности артистов
   - Сравнение жанров по количеству слушателей

## 6. Технический стек

### Backend:
- **Фреймворк:** Django 4.2 (Python 3.10+)
- **База данных:** SQLite (разработка), PostgreSQL (продакшен)
- **ORM:** Django ORM с расширенными запросами

### Внешние API:
- **Last.fm API** - получение данных о треках, артистах, жанрах
  - Методы: track.search, artist.getInfo, tag.getInfo
  - Формат: JSON
  - Аутентификация: API Key + Shared Secret

### Аналитика и визуализация:
- **Pandas** - обработка и анализ данных о популярности
- **NumPy** - численные вычисления для статистики
- **Plotly** - интерактивные графики и визуализации

### Frontend:
- **Bootstrap 5** - адаптивный интерфейс
- **Plotly.js** - динамические графики на клиенте
- **JavaScript (ES6+)** - интерактивные элементы

### Инфраструктура:
- **Хостинг:** PythonAnywhere
- **Версионный контроль:** Git, GitHub
- **Конфигурация:** python-dotenv, environment variables
- **Кэширование:** Файловое кэширование API запросов

## 7. Архитектура системы

### Поток данных:
```
Пользовательский запрос
        ↓
[    Last.fm API    ] → Поиск треков, артистов, жанров
        ↓
[    Локальная БД   ] → Сохранение и индексация данных
        ↓
[      Pandas       ] → Анализ популярности, статистика
        ↓
[  Plotly + Django  ] → Визуализация и представление
        ↓
Пользовательский интерфейс
```

### Ключевые сервисы:
1. **LastFMService** - работа с Last.fm API
2. **GenreAnalyzer** - анализ данных по жанрам
3. **SearchHandler** - обработка поисковых запросов
4. **VisualizationEngine** - генерация графиков и визуализаций

## 8. Критерии успеха

### Технические критерии:
1. **Работоспособность:** Все страницы загружаются без ошибок
2. **API интеграция:** Успешные запросы к Last.fm API
3. **Производительность:** Загрузка страниц за 2-3 секунды
4. **Данные:** 10-15 демо-записей в базе данных

### Функциональные критерии:
1. **Каталог жанров:** Просмотр списка жанров с информацией
2. **Поиск треков:** Работающая форма поиска через Last.fm API
3. **Аналитика:** Базовая статистика и графики по жанрам
4. **Интерфейс:** Адаптивный и понятный дизайн

## 9. Изменения в ходе реализации

### 20.12.2025: Первоначальная версия
- Утверждена базовая структура проекта
- Определены 3 основные модели

### 22.12.2025: Переход с Spotify API на Last.fm API
- **Причина:** Географические ограничения Spotify API
- **Решение:** Использование Last.fm API как более доступной альтернативы

### 23.12.2025: Миграция на MusicBrainz/AcousticBrainz API
- **Причина:** Last.fm ограничивает бесплатные запросы, требует API ключ
- **Решение:** Использование полностью открытых MusicBrainz и AcousticBrainz API
- **Преимущества:** 
  - Бесплатно без ограничений по количеству запросов
  - Прямой доступ к акустическому анализу
  - Более глубокая техническая информация
  - Работает в России без ограничений

### 02.01.2026: Возврат к Last.fm API после оценки доступности
- **Причина:** MusicBrainz API недоступен в России
- **Решение:** Возврат к проверенному Last.fm API с получением бесплатных ключей
- **Преимущества:** 
  - Работает в России без ограничений
  - 5,000 бесплатных запросов в день
  - Богатая база музыкальных данных
  - Простая интеграция с Django