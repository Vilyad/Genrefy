{% extends 'catalog/base.html' %}

{% block title %}{{ artist.name|default:artist_info.name }} - Genrefy{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'catalog:genre_list' %}">Главная</a></li>
        <li class="breadcrumb-item"><a href="{% url 'catalog:search' %}">Поиск</a></li>
        <li class="breadcrumb-item active">Исполнитель</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            {% if artist.image_url or artist_info.image %}
            <img src="{{ artist.image_url|default:artist_info.image }}"
                 class="card-img-top" alt="{{ artist.name|default:artist_info.name }}"
                 style="height: 300px; object-fit: cover;">
            {% endif %}

            <div class="card-body">
                <h2 class="card-title">{{ artist.name|default:artist_info.name }}</h2>

                <div class="row mt-3">
                    <div class="col-6">
                        <div class="text-center">
                            <h6 class="text-muted">Слушатели</h6>
                            <h4>
                                {{ artist.lastfm_listeners|default:artist_info.listeners|default:"0"|floatformat:"0" }}
                            </h4>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center">
                            <h6 class="text-muted">Прослушивания</h6>
                            <h4>
                                {{ artist.lastfm_playcount|default:artist_info.playcount|default:"0"|floatformat:"0" }}
                            </h4>
                        </div>
                    </div>
                </div>

                <div class="mt-3">
                    {% if artist_in_db or artist.id %}
                    <a href="{% url 'catalog:artist_detail' pk=artist.id|default:artist_in_db.id %}"
                       class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-database"></i> В базе
                    </a>
                    {% else %}
                    <a href="{% url 'catalog:save_track' %}?artist_name={{ artist_info.name|urlencode }}"
                       class="btn btn-success btn-sm">
                        <i class="fas fa-save"></i> Сохранить исполнителя
                    </a>
                    {% endif %}

                    {% if artist.lastfm_url or artist_info.url %}
                    <a href="{{ artist.lastfm_url|default:artist_info.url }}"
                       target="_blank" class="btn btn-outline-dark btn-sm">
                        <i class="fab fa-lastfm"></i> Last.fm
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>

        {% with artist_genres=artist.genres.all|default:artist_info.tags %}
        {% if artist_genres %}
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Жанры</h5>
                <div class="d-flex flex-wrap gap-2">
                    {% for genre in artist_genres %}
                    {% if genre.id %}
                    <a href="{% url 'catalog:genre_detail' genre.id %}" class="badge bg-primary text-decoration-none">
                        {{ genre.name }}
                    </a>
                    {% else %}
                    <span class="badge bg-secondary">{{ genre }}</span>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        {% endwith %}
    </div>

    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Популярные треки</h5>

                {% if top_tracks or top_tracks_lastfm %}
                <div class="list-group">
                    {% for track in top_tracks|default:top_tracks_lastfm %}
                    <a href="{% url 'catalog:track_detail' %}?artist={{ artist.name|default:artist_info.name|urlencode }}&track={{ track.name|default:track.title|urlencode }}"
                       class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ track.name|default:track.title }}</strong>
                            {% if track.album %}
                            <br><small class="text-muted">{{ track.album }}</small>
                            {% endif %}
                        </div>
                        <div class="text-end">
                            <span class="badge bg-primary rounded-pill">
                                {{ track.playcount|default:track.lastfm_playcount|default:"0"|floatformat:"0" }}
                            </span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">Информация о треках отсутствует</p>
                {% endif %}
            </div>
        </div>

        {% if artist.description or artist_info.bio %}
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Об исполнителе</h5>
                <div class="card-text">
                    {{ artist.description|default:artist_info.bio|safe|truncatewords:100 }}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}